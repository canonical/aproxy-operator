name: Integration tests

on:
  pull_request:

jobs:
  integration-tests:
    runs-on: ubuntu-22.04
    services:
      squid:
        image: sameersbn/squid:latest
        ports:
          - 3128:3128
    steps:
      - uses: actions/checkout@v4
      - name: Run integration tests
        uses: canonical/operator-workflows/.github/actions/integration_test@main
        with:
          load-test-enabled: false
          load-test-run-args: "-e LOAD_TEST_HOST=localhost"
          trivy-fs-enabled: true
          trivy-image-config: "trivy.yaml"
          juju-channel: '3/stable'
          provider: 'lxd'
