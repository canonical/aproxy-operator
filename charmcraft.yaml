# Copyright 2025 Canonical Ltd.
# See LICENSE file for licensing details.
# This file configures Charmcraft.
# See https://canonical-charmcraft.readthedocs-hosted.com/stable/howto/manage-charmcraft/ 
# for guidance.

type: charm
subordinate: true
name: aproxy
title: Aproxy Subordinate Charm
summary: A subordinate charm that deploys the aproxy application.
links:
  documentation: https://discourse.charmhub.io/aproxy-operator
  issues: https://github.com/canonical/aproxy-operator/issues
  source: https://github.com/canonical/aproxy-operator
  contact: https://launchpad.net/~canonical-is-devops

description: |
  The Aproxy subordinate charm installs and manages the aproxy snap to transparently
  intercept per-unit HTTP/HTTPS traffic and forward it to a target proxy, while preserving
  the original hostname.

  This charm is useful in environments that require transparent proxying for compliance,
  monitoring, or traffic redirection.

base: ubuntu@24.04
build-base: ubuntu@24.04
platforms: 
  amd64:
    build-on: [amd64]
    build-for: [amd64]

requires:
  aproxy:
    interface: aproxy
    scope: container

parts:
  charm:
    plugin: charm
    source: .
    charm-entrypoint: src/charm.py
    charm-binary-python-packages: []
    charm-python-packages: []
    charm-requirements: [requirements.txt]
    charm-strict-dependencies: false

# See https://documentation.ubuntu.com/charmcraft/stable/reference/files/charmcraft-yaml-file/
# for guidance.
config:
  options:
    proxy-address:
      description: Configures the target proxy IP address for traffic forwarding.
      type: string
    no-proxy:
      description: Comma-separated list of IP addresses that should bypass the proxy.
      default: "127.0.0.1"
      type: string
    intercept-ports:
      description: |
        Comma-separated list of ports to intercept and forward through the proxy.

        Support ranges (ex: "1024-35655"), the keyword “ALL”, or multiple ranges (ex: "80-90,1024-2048")
      default: "80,443"
      type: string
